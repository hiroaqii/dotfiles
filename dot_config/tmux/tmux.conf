# ============================================================
# Basic
# ============================================================
set -g mouse on


# ============================================================
# Terminal passthrough
#
# Required to allow advanced escape sequences (e.g. Kitty
# graphics protocol) to pass through tmux. This enables
# inline images in Ghostty even when running inside tmux.
#
# tmux 3.3+ required.
# ============================================================
set -g allow-passthrough on


# ============================================================
# Clipboard integration (macOS / Linux)
#
# Copy:
#   copy-mode-vi:
#     v : begin selection
#     y : copy selection to system clipboard and exit copy-mode
#
# Paste:
#   P : paste system clipboard into the active pane
# ============================================================

# Use vi keys in copy mode
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection


# ------------------------------------------------------------
# Copy to system clipboard
# ------------------------------------------------------------

# macOS
if-shell 'uname | grep -q Darwin' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"'

# Linux (Wayland)
if-shell 'command -v wl-copy >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "wl-copy"'

# Linux (X11 fallback)
if-shell 'command -v xclip >/dev/null 2>&1' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard -in"'


# ------------------------------------------------------------
# Paste from system clipboard
# ------------------------------------------------------------

# macOS
if-shell 'uname | grep -q Darwin' \
  'bind P run-shell "pbpaste | tmux load-buffer - && tmux paste-buffer"'

# Linux (Wayland)
if-shell 'command -v wl-paste >/dev/null 2>&1' \
  'bind P run-shell "wl-paste --no-newline | tmux load-buffer - && tmux paste-buffer"'

# Linux (X11 fallback)
if-shell 'command -v xclip >/dev/null 2>&1' \
  'bind P run-shell "xclip -selection clipboard -out | tmux load-buffer - && tmux paste-buffer"'


# ------------------------------------------------------------
# Allow tmux to manage/passthrough clipboard sequences (OSC52)
# ------------------------------------------------------------
set -g set-clipboard on


# ============================================================
# Plugins
# ============================================================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'nordtheme/tmux'


# ============================================================
# Initialize TPM
# (This line must be placed at the very bottom of the config)
# ============================================================
run '~/.tmux/plugins/tpm/tpm'


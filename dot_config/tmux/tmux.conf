# ============================================================
# tmux.conf (Ctrl-Space prefix, Ghostty + mac/arch friendly)
# Location: ~/.config/tmux/tmux.conf
# ============================================================

# ------------------------------------------------------------
# Basic / QoL
# ------------------------------------------------------------
set -g mouse on
set -g history-limit 200000
set -s escape-time 0
set -g focus-events on
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1

# Better colors in modern terminals (Ghostty)
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:Tc"
setw -g xterm-keys on

# ------------------------------------------------------------
# Prefix: Ctrl-Space
# ------------------------------------------------------------
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Optional:
# Pressing the prefix key twice sends a literal Ctrl-Space
# to the underlying application.
bind C-Space send-prefix

# ------------------------------------------------------------
# Splits: intuitive keys + keep current working directory
# ------------------------------------------------------------
unbind '"'
unbind %
bind - split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

# New window in current directory
bind c new-window -c "#{pane_current_path}"

# ------------------------------------------------------------
# Pane navigation / resize (Vim-friendly)
# ------------------------------------------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Swap panes (handy when reorganizing)
bind < swap-pane -U
bind > swap-pane -D

# Zoom
bind z resize-pane -Z

# ------------------------------------------------------------
# Reload
# ------------------------------------------------------------
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Reloaded tmux.conf"

# ------------------------------------------------------------
# Terminal passthrough (Kitty graphics / Ghostty inline images)
# tmux 3.3+ required
# ------------------------------------------------------------
set -g allow-passthrough on

# ------------------------------------------------------------
# Copy-mode (vi)
# ------------------------------------------------------------
setw -g mode-keys vi
bind Enter copy-mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi C-v send -X rectangle-toggle
bind -T copy-mode-vi Escape send -X cancel

# Allow tmux to manage/passthrough clipboard sequences (OSC52)
set -g set-clipboard on

# ------------------------------------------------------------
# Clipboard integration (macOS / Linux)
#   y : copy selection to system clipboard and exit copy-mode
#   P : paste system clipboard into active pane
# ------------------------------------------------------------
# Copy key (y)
if-shell 'uname | grep -q Darwin' \
  'bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"' \
  'if-shell "command -v wl-copy >/dev/null 2>&1" "bind -T copy-mode-vi y send -X copy-pipe-and-cancel \"wl-copy\"" "bind -T copy-mode-vi y send -X copy-pipe-and-cancel \"xclip -selection clipboard -in\""'


# Paste key (P)
if-shell 'uname | grep -q Darwin' \
  'bind P run-shell "pbpaste | tmux load-buffer - && tmux paste-buffer"' \
  'if-shell "command -v wl-paste >/dev/null 2>&1" "bind P run-shell \"wl-paste --no-newline | tmux load-buffer - && tmux paste-buffer\"" "bind P run-shell \"xclip -selection clipboard -out | tmux load-buffer - && tmux paste-buffer\""'


# ------------------------------------------------------------
# Popup helpers (tmux 3.2+)
# Great with: lazygit / yazi / fzf
# ------------------------------------------------------------
# lazygit popup
bind g display-popup -E -w 90% -h 90% -d "#{pane_current_path}" "lazygit"

# yazi popup
bind y display-popup -E -w 90% -h 90% -d "#{pane_current_path}" "yazi"

# quick session switch (fzf)
bind f display-popup -E -w 90% -h 60% "tmux list-sessions -F '#S' | fzf --prompt='session> ' | xargs -r tmux switch-client -t"

# tree selector (built-in, no deps)
bind w choose-tree -Zw

# ------------------------------------------------------------
# Plugins (TPM)
# ------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'nordtheme/tmux'

# Optional but recommended (uncomment if you want):
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'
# set -g @continuum-restore 'on'

# ------------------------------------------------------------
# Initialize TPM (must be at the very bottom)
# ------------------------------------------------------------
run '~/.tmux/plugins/tpm/tpm'

